{% extends "base.html" %}
{% load static %}
{% block content %}
<style>
  .centered-form {
    max-width: 500px;
    margin: 0 auto;
    text-align: left;
  }

  label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
  }


  .form-group {
    margin-bottom: 15px;
  }

  .form-buttons {
    text-align: center;
  }

  .form-label {
  display: block;
  font-weight: bold;
  margin-bottom: 5px;
  margin-left: -210px;  
}

.form-label-name{
  display: block;
  font-weight: bold;
  margin-bottom: 5px;
  margin-left: -260px;  
}

  .preview-image {
    display: block;
    margin: 0 auto;
  }
</style>

<h4 class="text-center">マイページ</h4>

<div class="container">
  {% if messages %}
    <div class="text-center">
      {% for message in messages %}
       {{ message.message }}
      {% endfor %}
    </div>
  {% endif %}

  <form method="POST" enctype="multipart/form-data" class="mt-3 centered-form">
    {% csrf_token %}

    <!-- プロフィール画像 -->
    <div class="mb-4 text-center">
      {% if user.user_image and user.user_image.name %} 
        <img id="preview" src="{{ user.user_image.url }}" width="120px" class="mb-2 rounded preview-image">
      {% else %}
        <img id="preview" src="{% static 'images/noimage.png' %}" width="120px" class="mb-2 rounded preview-image" alt="画像未設定">
      {% endif %}
      <br>
      <label for="file-upload" class="btn btn-info mt-2">画像を選択</label>
      <input type="file" id="file-upload" name="user_image" style="display:none;" onchange="previewImage(event)">
      {{ my_page_form.user_image }}
    </div>

    <!-- 名前 -->
    <div class="form-group text-center mb-3">
      <label for="{{ my_page_form.username.id_for_label }}" class="form-label-name">名前</label>
      {{ my_page_form.username }}
      {% for error in my_page_form.username.errors %}
        <div class="text-danger small">{{ error }}</div>
      {% endfor %}
    </div>

    <!-- メールアドレス -->
    <div class="form-group text-center mb-3">
      <label for="{{ my_page_form.email.id_for_label }}" class="form-label">メールアドレス</label>
      {{ my_page_form.email }}
      {% for error in my_page_form.email.errors %}
        <div class="text-danger small">{{ error }}</div>
      {% endfor %}
    </div>

    <!-- 更新ボタン -->
    <div class="form-buttons">
      <input type="submit" value="更新" class="btn btn-primary">
    </div>
  </form>

  <div class="text-center mt-3">
    <a href="{% url 'diary_app:change_password' %}">パスワード変更</a>
  </div>
</div>

<script>
function previewImage(event) {
  const preview = document.getElementById('preview');
  preview.src = URL.createObjectURL(event.target.files[0]);
  preview.onload = function() {
    URL.revokeObjectURL(preview.src);
  }
}
</script>
{% endblock %}
