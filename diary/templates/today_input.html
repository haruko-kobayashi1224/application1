{% extends "base.html" %}
{% block content %}
<style>

.today-input-form-wrapper {
  max-width: 1000px;
  margin: 60px auto;
  padding: 0 30px;  
}
   

.other-success-form {
  flex: 0 0 auto;
}

h4 {
  margin-top: 30px;
  margin-bottom: 20px;
}

h5 {
  margin-top: 30px;
  margin-bottom: 30px;
}

.checkbox-inline {
  display: inline-block;
  margin-right: 50px;
  margin-bottom: 10px;
}


.formset-flex {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  margin-top: 10px;
  margin-bottom: 20px;
}

.other-success-form {
  flex: 0 0 auto;
  margin-bottom: 10px;
}  

.other-success-form input {
  width: 300px;
  padding: 12px 16px;
  border: 1px solid #ccc;
  font-size: 16px;
}

p{
  margin-top: 40px;
  margin-bottom: 30px;
}

input[type="text"] {
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 15px;
  line-height: 1.4;
  box-sizing: border-box;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
}

  
.button-area {
  margin-top: 80px;
  margin-bottom: 60px;
  display: flex;
  justify-content: center;  
  gap: 50px;
}

#add-form-btn,
.btn  {
  min-width: 100px;
  gap: 10px;
  font-size: 1.2rem;
  border-radius: 5px;
  border: 1px solid #ccc;
}

#add-form-btn {
  background-color: #8ffefeff;
  padding: 10px 25px;
  color: black;
}

#add-form-btn:hover {
  background-color: #c4fbfbff;
  color: #000;               
  transition: 0.2s ease;      
}

.btn-cancel {
  background-color: #b4b4b4ff;
  padding: 10px 40px;
  color: #333;
}

.btn-cancel:hover {
  background-color: #e0e0e0;  
  color: #000;               
  transition: 0.2s ease;      
}

.btn-input {
  background-color: #007bff;
  padding: 15px 55px;
  color: white;
}

.btn-input:hover  {
  background-color: #449cfbff;
  color: white;                
  transition: 0.2s ease;      
}



#emptyModal{
    display:none;
    position:fixed;
    flex-direction: column;  
    top: 30%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    border: 2px solid #aaa;
    border-radius: 15px;
    padding: 40px 70px;
    z-index: 9999;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    text-align: center;
    font-size: 20px;
}

#emptyModal p {
    margin-bottom: 30px;
  }

#emptyModal button {
    padding: 12px 30px;
    font-size: 18px;
    background-color: #8d8c89e9;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    display: inline-block;
    width: auto;
    min-width: unset;
    max-width: 100px; 
    margin: 0 auto;
}

#emptyModal button:hover {
  background-color: #c5c4c2e9;!important; 
  color: white;           
  transition: 0.2s ease;      
}

.container  {
  padding-bottom: 30px;  
}



</style>

<div class="container">
{% if formset.non_form_errors %}
    <div>
      {% for error in formset.non_form_errors %}
          <p>{{ error}}</p>
      {% endfor%}
    </div> 
{% endif %}
  <div class="today-input-form-wrapper">
    <h4>{{ year }}年{{ month }}月{{ day }}日{{ weekday_jp  }}曜日</h4>
    <form method="POST" id="today_input_form">  
        {% csrf_token %}
        <h5>今日できたこと</h5>
        <div class="formset-flex">
          {% for checkbox in today_input_form.successes %}
            <label class="checkbox-inline">
             {{ checkbox.tag }} {{ checkbox.choice_label }}
           </label>
          {% endfor %}
        </div>  
        <p><strong>その他にできたことがあれば、20文字以内で書いてください</strong>&emsp; 例：勉強ができた</p>
          {{ formset.management_form }}
        <div id="formset-area">
          <div class="formset-flex" id="formset-container"> 
            {% for form in formset %}
            <div class="other-success-form">
                {{ form.other_success }}
            </div>
            {% endfor %}
          </div>
        </div>
        {% comment %} <div style="text-align: center; margin-bottom: 20px;">
          <button type="button" id="add-form-btn">＋追加</button>
        </div>      {% endcomment %}
        <p><strong>明日の目標があれば、20文字以内で書いてください</strong>&emsp; 例：朝6時に起きる</p>
        <div class="other-success-form">
        {{ today_input_form.tomorrow_goal }}
        </div>

        <div class="button-area">
          <button type="button" class="btn btn-cancel" onclick="location.href='{% url 'diary_app:month' year=year month=month  %}'">
           キャンセル
          </button> 
          <button type="submit" class="btn btn-input">作成</button>      
        </div>    
    </form>        
  </div>
</div>

<div id="emptyModal" >
    <p>できたことが入力されて<br>いないので作成できません</p>
    <button id="modalCloseBtn" >OK</button>
</div>


<script>
    {% comment %} document.addEventListener('DOMContentLoaded', function(){
        const addButton = document.getElementById("add-form-btn");    
        const formContainer = document.getElementById("formset-container");
        let formCount = {{ formset.total_form_count }};
        const maxForms =3;

        const originalForm = formContainer.children[0].cloneNode(true);

        addButton.addEventListener("click", function(){
            if (formCount >= maxForms) {
                alert("これ以上追加できません（最大3つ）");
                return;
            }
        
             const newForm = originalForm.cloneNode(true);
             newForm.innerHTML = newForm.innerHTML.replace(/form-0-/g, `form-${formCount}-`)
             formContainer.appendChild(newForm);
             
             const totalForms = document.querySelector("#id_form-TOTAL_FORMS");
             totalForms.value =formCount + 1;
             formCount++;

        });   {% endcomment %}
    
    const form = document.getElementById('today_input_form') || document.getElementById('other-success-form'); 
    const modal = document.getElementById('emptyModal');
    const modalCloseBtn = document.getElementById('modalCloseBtn');

    form.addEventListener('submit', function(event) {
        const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
        const textInputs = document.querySelectorAll('#formset-container input[type="text"]');
        
        
        let isTextFilled = false;
        for (const input of textInputs) {
            if (input.value.trim() !== '') {
                isTextFilled = true;
                break;
            }
        }

        if (checkboxes.length === 0 && !isTextFilled) {
            event.preventDefault();
            modal.style.display = 'flex';
        }
    });

    modalCloseBtn.addEventListener('click', function() {
        modal.style.display = 'none';
    });
{% comment %} }); {% endcomment %}
    
    
    
</script>


{% endblock %}




