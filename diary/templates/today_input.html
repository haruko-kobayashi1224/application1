{% extends "base.html" %}
{% block content %}

<h2>{{ year }}年{{ month }}月{{ day }}日</h2>
<form method="POST">    
{% csrf_token %}
<h3>今日できたこと</h3>
{% comment %} {{ today_input_form.今日できたこと.label_tag }} 
{{ today_input_form.今日できたこと }} {% endcomment %}
 
{{ today_input_form.successes }}
{{ formset.management_form }}
  <div id="formset-area">
    {% for form in formset %}
      <div class="other-success-form">
        {{ form.other_success }}
      </div>
    {% endfor %}
  </div>
  <button type="button" id="add-form-btn">＋追加</button>        
{% comment %} <button name="btn_add" type="submit">追加する </button> {% endcomment %}

<h3>明日の目標</h3>
{{ today_input_form.tomorrow_goal }}


<input type="submit" value="作成">
</form>    
<a href="{% url 'diary_app:month' year=today.year month=today.month %}">ホーム画面に戻る</a>  

<script>
  const addBtn = document.getElementById("add-form-btn");
  const formArea = document.getElementById("formset-area");
  let totalForms = document.getElementById("id_form-TOTAL_FORMS");

  addBtn.addEventListener("click", function () {
    const currentFormCount = parseInt(totalForms.value);
    const newForm = formArea.children[0].cloneNode(true); // 最初のフォームをコピー

    // 入力欄をクリア
    newForm.querySelector("input").value = "";

    // name属性などを正しく更新（管理用のインデックス変更）
    const newIndex = currentFormCount;
    const input = newForm.querySelector("input");
    input.name = input.name.replace(/form-\d+-/, `form-${newIndex}-`);
    input.id = input.id.replace(/form-\d+-/, `form-${newIndex}-`);

    formArea.appendChild(newForm);
    totalForms.value = newIndex + 1;
  });
</script>
{% endblock %}
